!function(a){"use strict";function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[n,o]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;c<16;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"function"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this),document.querySelectorAll||(document.querySelectorAll=function(a){var b,c=document.createElement("style"),d=[];for(document.documentElement.firstChild.appendChild(c),document._qsa=[],c.styleSheet.cssText=a+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),c.parentNode.removeChild(c);document._qsa.length;)b=document._qsa.shift(),b.style.removeAttribute("x-qsa"),d.push(b);return document._qsa=null,d}),~function($){"use strict";function getPcid(){var a=/\/(index.php|index.html|index.htm|index)$/,b=location.protocol+"//",c=location.host,d=location.pathname.replace(a,"/"),e=b+c+d;return md5("undefined"!=typeof _STAT_HASHNAME&&""!=_STAT_HASHNAME?_STAT_HASHNAME:e)}function getCookie(a){for(var b=document.cookie,c=removeBlanks(b),d=c.split(";"),e=0;e<d.length;e++){var f=d[e].split("=");if(f.length>1&&f[0]==a)return f[1]}return""}function removeBlanks(a){for(var b="",c=0;c<a.length;c++){var d=a.charAt(c);" "!=d&&(b+=d)}return b}function getRandomNum(){return Math.round(2147483647*Math.random())}function getVistor(a){var b=getCookie("xm_vistor"),c=!0,d="",e=0,f=(new Date).getTime();if(""!==b){var g=b.split("-");2==g.length&&(d=g[0],e=g[1],f-e<=18e5&&(c=!1))}return c&&(d=a+"_"+f),e=f,d}function getMstuid(){var a=new Date,b=a.getTime()+"_"+Math.round(1e4*Math.random());return b}function uuid(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;c<a;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;c<36;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("")}function getDomain(){var a=window.location.hostname,b=a.split(".");size=b.length;var c="."+b[size-2]+"."+b[size-1];return c}function getLanguage(){return navigator.language||navigator.userLanguage||navigator.browserLanguage||navigator.systemLanguage}function getVendor(){return navigator.vendor}function getPlatform(){return navigator.platform}function getScreen(){return screen.width+"*"+screen.height}function getVars(){var a="";if(vars==[])return"";for(var b in vars)a+="&"+b+"="+encodeURIComponent(vars[b]);return a}function getBaseParam(){var a=document.location.href.replace(/&/g,"|"),b=document.referrer.replace(/&/g,"|");if(b=b.toLowerCase()){getRefDomain(b),getCookie("lastsource")}var c=getCookie("xm_www_sid"),d=getCookie("mstuid"),e=getCookie("muuid"),f=getCookie("mucid"),g=getCookie("mutid"),h=getCookie("mstz")||"";if(""===h||h.split("|").length<3){var i=[];i[0]="",i[1]="",i[2]=getRandomNum().toString()+".0";i.join("|")}h=getCookie("mstz");var j=h.split("|")||[],k=(4==j.length?0:1,j[0]||""),l=j[1]||"",m=[];m=j[2].split(".");var n=m[0],o=parseInt(m[1])+1;j[2]=m[0]+"."+o.toString();var p=j[3]||"",q=j[4]||"",r=j[5]||"",s=0,t=encodeURIComponent(b);""==t&&(q="",r=""),t!=q&&a!=b?(r=q,q=t):""!=t&&(s=1),j[3]=p,j[4]=q,j[5]=r;var u=getCookie("lastsource"),v=0,w=new Date;w.setTime(w.getTime()+62208e6),""===d&&(v=1,d=getMstuid());var x="",y=new Date;vars.curl=location.href,vars.xmv=getVistor(d),vars.v="1.4.09",void 0===vars.vuuid&&(vars.vuuid=uuid(16,32));var z=getCookie("userId"),A="";return isApp&&(z||(z=triggerString("get_encrypt_uid")),A=triggerString("get_shop_deviceid")),x="mid="+(getCookie("euid")||z)+"&device_id="+A+"&phpsessid="+c+"&mstuid="+d+"&muuid="+e+"&mucid="+f+"&sessionId="+n+"&step="+o+"&new_visitor="+v+"&mstprevpid="+encodeURIComponent(k)+"&mstprev_pid_loc="+p+"&prevtarget="+l+"&lastsource="+u+"&timestamp="+y.getTime()+"&ref="+t+"&domain="+getDomain()+"&screen="+getScreen()+"&language="+getLanguage()+"&vendor="+getVendor()+"&platform="+getPlatform()+"&gu="+r+"&pu="+q+"&rf="+s+"&mutid="+g+"&muwd="+encodeURIComponent(getCookie("muwd"))}function _init(){_isInitialized||(_defaultSettings={elements_selector:"img",container:window,threshold:300,throttle:300,skip_invisible:!0,callback_load:null,callback_error:null,callback_set:null,callback_processed:null},_supportsAddEventListener=!!window.addEventListener,_supportsAttachEvent=!!window.attachEvent,_supportsClassList=!!document.body.classList,_isInitialized=!0)}function _addEventListener(a,b,c){return _supportsAddEventListener?void a.addEventListener(b,c):void(_supportsAttachEvent&&(a.attachEvent("on"+b,function(a){return function(){c.call(a,window.event)}}(a)),a=null))}function _removeEventListener(a,b,c){return _supportsAddEventListener?void a.removeEventListener(b,c):void(_supportsAttachEvent&&a.detachEvent("on"+b,c))}function _isInsideViewport(a,b,c){function d(){return window.innerWidth||l.documentElement.clientWidth||document.body.clientWidth}function e(){return window.innerHeight||l.documentElement.clientHeight||document.body.clientHeight}function f(a){return a.getBoundingClientRect().top+m-l.documentElement.clientTop}function g(a){return a.getBoundingClientRect().left+n-l.documentElement.clientLeft}function h(){var d;return d=b===window?e()+m:f(b)+b.offsetHeight,d<=f(a)-c}function i(){var e;return e=b===window?d()+window.pageXOffset:g(b)+d(),e<=g(a)-c}function j(){var d;return d=b===window?m:f(b),d>=f(a)+c+a.offsetHeight}function k(){var d;return d=b===window?n:g(b),d>=g(a)+c+a.offsetWidth}var l,m,n;return l=a.ownerDocument,m=window.pageYOffset||l.body.scrollTop,n=window.pageXOffset||l.body.scrollLeft,!(h()||j()||i()||k())}function _now(){var a=new Date;return a.getTime()}function _merge_objects(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d}function _convertToArray(a){try{return Array.prototype.slice.call(a)}catch(e){var b,c=[],d=a.length;for(b=0;b<d;b++)c.push(a[b]);return c}}function _bind(a,b){return function(){return a.apply(b,arguments)}}function LazyLoad(a){_init(),this._settings=_merge_objects(_defaultSettings,a),this._queryOriginNode=this._settings.container===window?document:this._settings.container,this._previousLoopTime=0,this._loopTimeout=null,this._handleScrollFn=_bind(this.handleScroll,this),_addEventListener(window,"resize",this._handleScrollFn),this.update()}function getRefDomain(a){var b=document.createElement("a");return b.href=a,b.hostname}var _defaultSettings,_supportsAddEventListener,_supportsAttachEvent,_supportsClassList,_isInitialized=!1,exposure=null,msf=function(){this.p=[]};msf.prototype.push=function(a){return"function"==typeof a[0]?void a[0](a.slice(1)):void("setDomainId"!=a[0]&&"setVars"!=a[0]||this[a[0]](a.slice(1)))},msf.prototype.setVars=function(a){vars[a[0]]=a[1]},msf.prototype.setDomainId=function(a){vars.domain_id=a[0]};var _msf=new msf;_msf.p=window._msq.p;var initMsq=function(){for(i=0;i<_msf.p.length;i++)_msf.push(_msf.p[i])},vars=[];initMsq();var userAgent=navigator.userAgent.toLowerCase(),_we=window.WE||{},isApp=function(){return"undefined"!=typeof WE&&userAgent.indexOf("xiaomi/miuibrowser/4.3/shop")!==-1&&userAgent.indexOf("iphone")===-1}(),triggerString=function(a){return _we.triggerString&&_we.triggerString(a,"")||""};LazyLoad.prototype._loopThroughElements=function(){var i,element,settings=this._settings,elements=this._elements,elementsLength=elements?elements.length:0,insideLogs=[],insideLogCodes=[],logValue="",logCodeValue="",processedIndexes=[];for(i=0;i<elementsLength;i++)element=elements[i],settings.skip_invisible&&null===element.offsetParent||_isInsideViewport(element,settings.container,settings.threshold)&&((logValue=element.getAttribute("data-log_code"))&&(insideLogs.push(logValue),(logCodeValue=element.getAttribute("onclick"))&&(logCodeValue=eval(logCodeValue.replace("_msq.push","")),5==logCodeValue.length&&insideLogCodes.push(logCodeValue[1]))),processedIndexes.push(i),element.wasProcessed=!0);for(insideLogs.length&&this._sendData(insideLogCodes.join(";"),encodeURIComponent(insideLogs.join(";")));processedIndexes.length>0;)elements.splice(processedIndexes.pop(),1),settings.callback_processed&&settings.callback_processed(elements.length);0===elementsLength&&this._stopScrollHandler()},LazyLoad.prototype._sendData=function(a,b){vars.pageid=getPcid();var c=getBaseParam(),d=getVars(),e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//a.stat.xiaomi.com/js/mstr.js?"+c+d+"&type=sp&logs="+a+"&log_codes="+b;var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f)},LazyLoad.prototype._purgeElements=function(){var a,b,c=this._elements,d=c.length,e=[];for(a=0;a<d;a++)b=c[a],b.wasProcessed&&e.push(a);for(;e.length>0;)c.splice(e.pop(),1)},LazyLoad.prototype._startScrollHandler=function(){this._isHandlingScroll||(this._isHandlingScroll=!0,_addEventListener(this._settings.container,"scroll",this._handleScrollFn))},LazyLoad.prototype._stopScrollHandler=function(){this._isHandlingScroll&&(this._isHandlingScroll=!1,_removeEventListener(this._settings.container,"scroll",this._handleScrollFn))},LazyLoad.prototype.handleScroll=function(){var a,b,c;this._settings&&(b=_now(),c=this._settings.throttle,0!==c?(a=c-(b-this._previousLoopTime),a<=0||a>c?(this._loopTimeout&&(clearTimeout(this._loopTimeout),this._loopTimeout=null),this._previousLoopTime=b,this._loopThroughElements()):this._loopTimeout||(this._loopTimeout=setTimeout(_bind(function(){this._previousLoopTime=_now(),this._loopTimeout=null,this._loopThroughElements()},this),a))):this._loopThroughElements())},LazyLoad.prototype.update=function(){this._elements=_convertToArray(this._queryOriginNode.querySelectorAll(this._settings.elements_selector)),this._purgeElements(),this._loopThroughElements(),this._startScrollHandler()},LazyLoad.prototype.destroy=function(){_removeEventListener(window,"resize",this._handleScrollFn),this._loopTimeout&&(clearTimeout(this._loopTimeout),this._loopTimeout=null),this._stopScrollHandler(),this._elements=null,this._queryOriginNode=null,this._settings=null};var defaults={propertyName:"data-stat-id",urlParam:"stat",needMap:!0,domain:".mi.com",live:!1},_Options,_Global={parentLoop:!1,sonLoop:!1,drawDataScript:"http://c1.mifile.cn/f/i/15/stat/js/jquery.dataDraw.min.js",jquerySource:"http://s01.mifile.cn/js/lib/jquery.min.js",re:{normalEnd:/\/(index.php|index.html|index.htm|index)$/,snapshotModalDate:/^(\/\d{10}\/)/,snapshotModalEnd:/.html$/},locationObj:{protocol:location.protocol+"//",host:location.host,pathname:location.pathname}},linksignCommon={isSnapshotModal:function(){return"file.stat.be.xiaomi.com"==location.host},hashSnapshotModal:function(){return _Global.locationObj.protocol+location.pathname.replace(_Global.re.snapshotModalDate,"").replace(_Global.re.snapshotModalEnd,"").replace(_Global.re.normalEnd,"/")},getPageHash:function(){var a=_Global.locationObj;a.pathname=a.pathname.replace(_Global.re.normalEnd,"/");var b=this.isSnapshotModal()?this.hashSnapshotModal():objectValues(a,"");return"undefined"!=typeof _STAT_HASHNAME&&""!=_STAT_HASHNAME?md5(_STAT_HASHNAME):md5(b)},isOpenCanvas:function(){return!(!_Options.needMap||!getLocationName(_Options.urlParam,"search")||"true"!=getLocationName(_Options.urlParam,"search"))},trim:function(a){try{return a.replace(/\s/g,"")}catch(b){return a}},appendStatModal:function(a){var b=linksignCommon.trim(a.attr("href"))||"";if(this.isOpenCanvas()&&b.indexOf("/")!=-1&&(b.indexOf("http")==-1||b.indexOf(_Options.domain)!=-1)){var c,d=(_Options.urlParam+"=true",{hashName:b.split("#"),searchName:b.split("?")});if(this.isSnapshotModal()){var e=d.searchName[0].replace("http://",""),f=location.pathname.replace(_Global.re.snapshotModalDate,"").replace(_Global.re.snapshotModalEnd,"");c=location.href.replace(f,e)}else c=d.hashName[1]?d.hashName[0]+"?"+_Options.urlParam+"=true#"+d.hashName[1]:d.searchName[1]?b+"&"+_Options.urlParam+"=true":b+"?"+_Options.urlParam+"=true";a.attr("href",c)}}},loadScript=function(a,b){var c,d=document.head||document.getElementsByTagName("head")[0]||document.documentElement;c=document.createElement("script"),c.async="async",c.src=a,c.onload=c.onreadystatechange=function(){c.readyState&&!/loaded|complete/.test(c.readyState)||(c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=void 0,b())},d.insertBefore(c,d.firstChild)},linkDataSign=function(){loadScript(_Global.drawDataScript,function(a,b,c){$("body").linkSigntoDraw({pageID:linksignCommon.getPageHash()})})},getLocationName=function(a,b){var c="",d=!1,e="hash"==b?location.hash:location.search,f="hash"==b?"#":"?";if(0===e.length)return c;if(0==e.indexOf(f)&&e.indexOf("=")>1)for(var g=e.substring(1,e.length).split("&"),h=0;h<g.length&&!d;)g[h].indexOf("=")>0&&g[h].split("=")[0].toLowerCase()==a.toLowerCase()&&(c=g[h].split("=")[1],d=!0),h++;return c},_setAttrs=function(a,b,c){var d=$(a).hasClass("J_linksign-customize"),e=d?$(a).children():$(a).find("a"),f={page:linksignCommon.getPageHash(),point:null},g=e.length-1,h=linksignCommon.isOpenCanvas();b===c&&(_Global.parentLoop=!0),e.each(function(a,c){if("true"!=$(c).attr("data-stat-exclude")){var e=linksignCommon.trim($(c).attr("href"))||$(c).attr("data-stat-productid")||"",i=linksignCommon.trim($(c).text()),j=$(c).parent().parent().attr("class")||$(c).parent().parent().parent().attr("class")||"",k=b+""+a,l=$(c).attr("data-stat-aid"),m=$(c).attr("data-stat-pid"),n=$(c).attr("data-log_code")||"";e=e.indexOf(_Options.domain)!==-1?e.split("?")[0]:e;var o=e+i+j;o=d?o+k:o,f.point=m?l+"+"+m:md5(o);var p=$(c).attr("onclick")||"",q=_trackEvent(objectValues(f,"-"),e,n),r=q+p;$(c).attr(_Options.propertyName)||$(c).attr(_Options.propertyName,f.point).attr("onclick",r),linksignCommon.appendStatModal($(c)),_Global.parentLoop===!0&&a===g&&h&&(_Global.sonLoop=!0,linkDataSign())}})},_trackEvent=function(a,b,c){return"_msq.push(['trackEvent', '"+a+"', '"+b+"', 'pcpid', '"+c+"']);"},objectValues=function(a,b){var c=[];if("undefined"!=typeof a)for(var d in a){var e=a[d];e=null==e||""==e?"00":e,c.push(e)}return c.join(b)};$.fn.linkSign=function(a){_Options=$.extend(defaults,a);var b=this.length-1;this.each(function(a,c){_setAttrs(this,a,b)}),exposure?exposure.update():exposure=new LazyLoad({elements_selector:".exposure"})},$(function(){$("body,.J_linksign-customize").linkSign()})}(window.jQuery||Zepto);